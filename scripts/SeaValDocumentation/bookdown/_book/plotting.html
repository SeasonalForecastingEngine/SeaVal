<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Plotting |  The SeaVal package for validating seasonal weather forecasts</title>
  <meta name="description" content="<br />
The <code>SeaVal</code> package for validating seasonal weather forecasts</p>" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Plotting |  The SeaVal package for validating seasonal weather forecasts" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Plotting |  The SeaVal package for validating seasonal weather forecasts" />
  
  
  

<meta name="author" content="Claudio Heinrich and Michael Scheuerer, with input from" />
<meta name="author" content="Masilin Gudoshava, Eunice Koech, Anthony Mwanthi, Zewdu Segele, Hussen Seid and Thordis Thorarinsdottir" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="getting-started.html"/>
<link rel="next" href="data-import-and-processing.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="1" data-path="getting-started.html"><a href="getting-started.html"><i class="fa fa-check"></i><b>1</b> Getting Started</a>
<ul>
<li class="chapter" data-level="1.1" data-path="getting-started.html"><a href="getting-started.html#installation"><i class="fa fa-check"></i><b>1.1</b> Installation</a></li>
<li class="chapter" data-level="1.2" data-path="getting-started.html"><a href="getting-started.html#examples-of-data.table-syntax"><i class="fa fa-check"></i><b>1.2</b> examples of <code>data.table</code> syntax</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="plotting.html"><a href="plotting.html"><i class="fa fa-check"></i><b>2</b> Plotting</a>
<ul>
<li class="chapter" data-level="2.1" data-path="plotting.html"><a href="plotting.html#plotting-values-for-selected-countries"><i class="fa fa-check"></i><b>2.1</b> Plotting values for selected countries</a></li>
<li class="chapter" data-level="2.2" data-path="plotting.html"><a href="plotting.html#customized-plots"><i class="fa fa-check"></i><b>2.2</b> Customized plots</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-import-and-processing.html"><a href="data-import-and-processing.html"><i class="fa fa-check"></i><b>3</b> Data import and processing</a>
<ul>
<li class="chapter" data-level="3.1" data-path="data-import-and-processing.html"><a href="data-import-and-processing.html#netcdf_to_dt"><i class="fa fa-check"></i><b>3.1</b> The function <code>netcdf_to_dt</code></a></li>
<li class="chapter" data-level="3.2" data-path="data-import-and-processing.html"><a href="data-import-and-processing.html#downloading-and-processing-chirps-data"><i class="fa fa-check"></i><b>3.2</b> Downloading and processing CHIRPS data</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="data-import-and-processing-1.html"><a href="data-import-and-processing-1.html"><i class="fa fa-check"></i><b>4</b> Data import and processing</a>
<ul>
<li class="chapter" data-level="4.1" data-path="data-import-and-processing-1.html"><a href="data-import-and-processing-1.html#data-examples"><i class="fa fa-check"></i><b>4.1</b> Reshaping data</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="data-import-and-processing-1.html"><a href="data-import-and-processing-1.html#cv-data"><i class="fa fa-check"></i><b>4.1.1</b> Example: cross-validation data</a></li>
<li class="chapter" data-level="4.1.2" data-path="data-import-and-processing-1.html"><a href="data-import-and-processing-1.html#ex-corrupted-netcdf"><i class="fa fa-check"></i><b>4.1.2</b> Example: ‘corrupted’ netcdf</a></li>
<li class="chapter" data-level="4.1.3" data-path="data-import-and-processing-1.html"><a href="data-import-and-processing-1.html#us-obs"><i class="fa fa-check"></i><b>4.1.3</b> Example: Upscaling observations</a></li>
<li class="chapter" data-level="4.1.4" data-path="data-import-and-processing-1.html"><a href="data-import-and-processing-1.html#data-ex-prexc"><i class="fa fa-check"></i><b>4.1.4</b> Example: preparing data for evaluating exceedence probabilities</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="validation.html"><a href="validation.html"><i class="fa fa-check"></i><b>5</b> Validation</a>
<ul>
<li class="chapter" data-level="5.1" data-path="validation.html"><a href="validation.html#cv-eval"><i class="fa fa-check"></i><b>5.1</b> Evaluating cross-validation predictions</a></li>
<li class="chapter" data-level="5.2" data-path="validation.html"><a href="validation.html#evaluating-tercile-forecasts"><i class="fa fa-check"></i><b>5.2</b> Evaluating Tercile Forecasts</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="validation.html"><a href="validation.html#eval-terciles"><i class="fa fa-check"></i><b>5.2.1</b> Proper scoring rules for full tercile forecasts</a></li>
<li class="chapter" data-level="5.2.2" data-path="validation.html"><a href="validation.html#eval-terciles2"><i class="fa fa-check"></i><b>5.2.2</b> Evaluation when only the highest probability category is avaliable</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="validation.html"><a href="validation.html#eval-ex-pr"><i class="fa fa-check"></i><b>5.3</b> Exceedence probabilities</a></li>
<li class="chapter" data-level="5.4" data-path="validation.html"><a href="validation.html#temperature"><i class="fa fa-check"></i><b>5.4</b> Temperature</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="validation-1.html"><a href="validation-1.html"><i class="fa fa-check"></i><b>6</b> Validation</a>
<ul>
<li class="chapter" data-level="6.1" data-path="validation-1.html"><a href="validation-1.html#upscaling"><i class="fa fa-check"></i><b>6.1</b> Matching predictions and observations</a></li>
<li class="chapter" data-level="6.2" data-path="validation-1.html"><a href="validation-1.html#evaluating-weekly-predictions-of-precipitation"><i class="fa fa-check"></i><b>6.2</b> Evaluating weekly predictions of precipitation</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><p><img src="logo_CONFER.png" style="width:2in" /><br />
The <code>SeaVal</code> package for validating seasonal weather forecasts</p></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="plotting" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Plotting</h1>
<p>The function <code>ggplot_dt</code> takes a data table containing two columns named <code>lon</code> and <code>lat</code> that should specify a regular longitude-latitude grid, as well as some data to use for coloring the map.
The naming of the columns is important in that the function will not work if you, for example, name the longitude column <code>long</code> or <code>Lon</code>. An easy example is the following</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="plotting.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;chirps_monthly&quot;</span>)</span>
<span id="cb39-2"><a href="plotting.html#cb39-2" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">=</span> <span class="fu">copy</span>(chirps_monthly) <span class="co"># to manipulate the data table: chirps_monthly has locked binding</span></span>
<span id="cb39-3"><a href="plotting.html#cb39-3" aria-hidden="true" tabindex="-1"></a>dt2020 <span class="ot">=</span> dt[year <span class="sc">==</span> <span class="dv">2020</span> <span class="sc">&amp;</span> month <span class="sc">==</span> <span class="dv">10</span>] <span class="co"># reduce the observed precipitation data to a single time slice, namely October 2020</span></span>
<span id="cb39-4"><a href="plotting.html#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co"># our data now looks like this:</span></span>
<span id="cb39-5"><a href="plotting.html#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(dt2020) </span></code></pre></div>
<pre><code>##        lon   lat        prec month year terc_cat
##    1: 22.0 -12.0 2.981750252    10 2020        0
##    2: 22.0 -11.5 3.382063644    10 2020        0
##    3: 22.0 -11.0 3.250394658    10 2020        0
##    4: 22.0 -10.5 3.065396443    10 2020       -1
##    5: 22.0 -10.0 3.416906726    10 2020       -1
##   ---                                           
## 3480: 51.5  21.0 0.033333333    10 2020       -1
## 3481: 51.5  21.5 0.033333333    10 2020        0
## 3482: 51.5  22.0 0.032608688    10 2020       -1
## 3483: 51.5  22.5 0.001594238    10 2020       -1
## 3484: 51.5  23.0 0.000000000    10 2020       -1</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="plotting.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot_dt</span>(dt2020,<span class="st">&#39;prec&#39;</span>) <span class="co"># we pass the data table and the name of the column containing the plotting data,</span></span></code></pre></div>
<p><img src="02-plotting_files/figure-html/unnamed-chunk-1-1.png" width="480" /></p>
<p>As we can see, the color scale here makes no sense (blue meaning no precipitation) and we’ll talk about that in a second. But let’s start at the base functionality. <code>ggplot_dt</code> requires two arguments, the first one being a data table containing the data, and the second one is the name of the column that contains the data you want to plot. This defaults to the third column in the data table (often your data table will start with lon, lat, and the third column is what you want to plot). So in the example above, <code>ggplot_dt(dt)</code> would have led to the same result, because <code>'prec'</code> is the third column in <code>dt</code>. The plotting window is determined by the data. If you have data covering the entire earth, the entire earth would be plotted. As a consequence, we can restrict the plotted region by subsetting the data table:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="plotting.html#cb42-1" aria-hidden="true" tabindex="-1"></a>dt_sub  <span class="ot">=</span> dt2020[lon <span class="sc">%between%</span> <span class="fu">c</span>(<span class="dv">28</span>,<span class="dv">43</span>) <span class="sc">&amp;</span> lat <span class="sc">%between%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">12</span>,<span class="dv">1</span>)] <span class="co"># a region containing Tanzania</span></span>
<span id="cb42-2"><a href="plotting.html#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot_dt</span>(dt_sub)</span></code></pre></div>
<p><img src="02-plotting_files/figure-html/unnamed-chunk-2-1.png" width="480" /></p>
<p>The function has further optional arguments (also recall that you can access the function documentation summarizing all of this by typing <code>?ggplot_dt</code>):</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="plotting.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot_dt</span>(dt_sub,<span class="st">&#39;prec&#39;</span>,</span>
<span id="cb43-2"><a href="plotting.html#cb43-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">mn =</span> <span class="st">&#39;October 2020 precipitation&#39;</span>, <span class="co"># add a title to the plot</span></span>
<span id="cb43-3"><a href="plotting.html#cb43-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">rr =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">10</span>), <span class="co"># fix the limits of the color scale</span></span>
<span id="cb43-4"><a href="plotting.html#cb43-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">name =</span> <span class="st">&#39;mm/day&#39;</span>) <span class="co"># change the legend label</span></span></code></pre></div>
<p><img src="02-plotting_files/figure-html/unnamed-chunk-3-1.png" width="480" /></p>
<p>In this example we set the lower limit of the color scale to 1 and the upper limit to 10. By default the data is truncated at the ends of the color scale, so every pixel with precipitation of below 1mm/day is now shown in the same blue color, the color corresponding to a value of 1 mm. Setting the range of the color scale is useful for making several plots comparable or to force symmetry around 0, e.g. when plotting correlations or anomalies:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="plotting.html#cb44-1" aria-hidden="true" tabindex="-1"></a>dt[,clim <span class="sc">:</span><span class="er">=</span> <span class="fu">mean</span>(prec), by <span class="ot">=</span> .(lon,lat,month)] <span class="co"># add a climatology column to dt</span></span>
<span id="cb44-2"><a href="plotting.html#cb44-2" aria-hidden="true" tabindex="-1"></a>dt[,ano <span class="sc">:</span><span class="er">=</span> prec <span class="sc">-</span> clim] <span class="co"># add an anomaly column to dt</span></span>
<span id="cb44-3"><a href="plotting.html#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(dt)</span></code></pre></div>
<pre><code>##          lon   lat      prec month year terc_cat      clim          ano
##      1: 22.0 -12.0 1.9301587    10 1981       -1 2.8169255 -0.886766778
##      2: 22.0 -11.5 2.1351602    10 1981       -1 3.0905585 -0.955398264
##      3: 22.0 -11.0 2.7692883    10 1981       -1 3.4675703 -0.698281996
##      4: 22.0 -10.5 3.9201619    10 1981        0 3.8808617  0.039300191
##      5: 22.0 -10.0 4.8720656    10 1981        1 4.2989969  0.573068714
##     ---                                                                
## 418076: 51.5  21.0 0.2404348    12 2020       -1 0.2559819 -0.015547112
## 418077: 51.5  21.5 0.2184058    12 2020       -1 0.2415870 -0.023181188
## 418078: 51.5  22.0 0.2053623    12 2020       -1 0.2151377 -0.009775418
## 418079: 51.5  22.5 0.1615942    12 2020       -1 0.1870797 -0.025485473
## 418080: 51.5  23.0 0.1387682    12 2020       -1 0.1701314 -0.031363167</code></pre>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="plotting.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot_dt</span>(dt[month <span class="sc">==</span> <span class="dv">10</span> <span class="sc">&amp;</span> year <span class="sc">==</span> <span class="dv">2020</span>], <span class="st">&#39;ano&#39;</span>, <span class="at">rr =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="dv">3</span>))</span></code></pre></div>
<p><img src="02-plotting_files/figure-html/unnamed-chunk-4-1.png" width="480" /></p>
<p>Now, in this plot positive rainfall anomalies are shown red while negative anomalies are blue, which is very unintuitive. The function allows us to specify the three used colors by name with the arguments <code>low</code>,<code>mid</code>, and <code>high</code>. An overview over available color names can be found <a href="http://sape.inf.usi.ch/quick-reference/ggplot2/colour">here</a>. So here’s an anomaly plot looking a bit nicer:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="plotting.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot_dt</span>(dt[month <span class="sc">==</span> <span class="dv">10</span> <span class="sc">&amp;</span> year <span class="sc">==</span> <span class="dv">2020</span>], <span class="st">&#39;ano&#39;</span>, </span>
<span id="cb47-2"><a href="plotting.html#cb47-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">mn =</span> <span class="st">&#39;October 2020 rainfall anomaly&#39;</span>,</span>
<span id="cb47-3"><a href="plotting.html#cb47-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">rr =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="dv">3</span>),</span>
<span id="cb47-4"><a href="plotting.html#cb47-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">low =</span> <span class="st">&#39;red&#39;</span>, <span class="at">mid =</span> <span class="st">&#39;white&#39;</span>, <span class="at">high =</span> <span class="st">&#39;darkgreen&#39;</span>,</span>
<span id="cb47-5"><a href="plotting.html#cb47-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">name =</span> <span class="st">&#39;mm/day&#39;</span>)</span></code></pre></div>
<p><img src="02-plotting_files/figure-html/unnamed-chunk-5-1.png" width="480" /></p>
<p>Note that we set the range argument to <code>c(-3,3)</code>. Fixing the range mostly makes sense when the range is known (e.g. for correlation plots), or when you want to compare several plots (e.g. for comparing mean square error of different NWP models, all plots should have the same range). If we leave the range argument <code>rr</code> free, the range is determined from the data. However, when we do this for our anomaly plot this has an undesired sideeffect:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="plotting.html#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot_dt</span>(dt[month <span class="sc">==</span> <span class="dv">10</span> <span class="sc">&amp;</span> year <span class="sc">==</span> <span class="dv">2020</span>], <span class="st">&#39;ano&#39;</span>, </span>
<span id="cb48-2"><a href="plotting.html#cb48-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">mn =</span> <span class="st">&#39;October 2020 rainfall anomaly&#39;</span>,</span>
<span id="cb48-3"><a href="plotting.html#cb48-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">low =</span> <span class="st">&#39;red&#39;</span>, <span class="at">mid =</span> <span class="st">&#39;white&#39;</span>, <span class="at">high =</span> <span class="st">&#39;darkgreen&#39;</span>,</span>
<span id="cb48-4"><a href="plotting.html#cb48-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">name =</span> <span class="st">&#39;mm/day&#39;</span>)</span></code></pre></div>
<p><img src="02-plotting_files/figure-html/unnamed-chunk-6-1.png" width="480" /></p>
<p>The color scale is no longer centered (white) at 0, but in the center of the (now asymetric) range. As a consequence, all gridpoints with anomaly 0 are shown in a light red. To fix this, we can use the <code>midpoint</code> argument:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="plotting.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot_dt</span>(dt[month <span class="sc">==</span> <span class="dv">10</span> <span class="sc">&amp;</span> year <span class="sc">==</span> <span class="dv">2020</span>], <span class="st">&#39;ano&#39;</span>, </span>
<span id="cb49-2"><a href="plotting.html#cb49-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">mn =</span> <span class="st">&#39;October 2020 rainfall anomaly&#39;</span>,</span>
<span id="cb49-3"><a href="plotting.html#cb49-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">low =</span> <span class="st">&#39;red&#39;</span>, <span class="at">mid =</span> <span class="st">&#39;white&#39;</span>, <span class="at">high =</span> <span class="st">&#39;darkgreen&#39;</span>,</span>
<span id="cb49-4"><a href="plotting.html#cb49-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">midpoint =</span> <span class="dv">0</span>,</span>
<span id="cb49-5"><a href="plotting.html#cb49-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">name =</span> <span class="st">&#39;mm/day&#39;</span>)</span></code></pre></div>
<p><img src="02-plotting_files/figure-html/unnamed-chunk-7-1.png" width="480" /></p>
<p>Another, maybe surprising, use for the <code>midpoint</code> argument is that we can generate plots with a colorscale with only two colors. For example, going back to plotting the observed rainfall we can do the following:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="plotting.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot_dt</span>(dt[month <span class="sc">==</span> <span class="dv">10</span> <span class="sc">&amp;</span> year <span class="sc">==</span> <span class="dv">2020</span>], <span class="st">&#39;prec&#39;</span>, </span>
<span id="cb50-2"><a href="plotting.html#cb50-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">mn =</span> <span class="st">&#39;October 2020 rainfall&#39;</span>,</span>
<span id="cb50-3"><a href="plotting.html#cb50-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">mid =</span> <span class="st">&#39;white&#39;</span>, <span class="at">high =</span> <span class="st">&#39;blue&#39;</span>,</span>
<span id="cb50-4"><a href="plotting.html#cb50-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">midpoint =</span> <span class="dv">0</span>,</span>
<span id="cb50-5"><a href="plotting.html#cb50-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">name =</span> <span class="st">&#39;mm/day&#39;</span>)</span></code></pre></div>
<p><img src="02-plotting_files/figure-html/unnamed-chunk-8-1.png" width="480" /></p>
<p>Here, we set the midpoint to 0, which is the minimum of our data (since observed rainfall is never below 0). Consequently, the second half of the colorscale extending below 0 is ignored.</p>
<p>Finally, the function allows to discretize the color scale. To this end the argument <code>discrete_cs</code> should be set to <code>TRUE</code>. We can then control the breaks of the discrete colorscale by one of the arguments <code>binwidth</code>, <code>n.breaks</code>, or <code>breaks</code> (the latter takes a vector containing all breakpoints). Using <code>binwidth</code> is recommended: The argument <code>n.breaks</code> (which is passed to the function <code>ggplot2::scale_fill_steps2</code>) tries to find ‘nice’ breaks and does not work reliably, and <code>breaks</code> is often a bit tedious. To revisit the anomaly plot from above:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="plotting.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot_dt</span>(dt[month <span class="sc">==</span> <span class="dv">10</span> <span class="sc">&amp;</span> year <span class="sc">==</span> <span class="dv">2020</span>], <span class="st">&#39;ano&#39;</span>, </span>
<span id="cb51-2"><a href="plotting.html#cb51-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">mn =</span> <span class="st">&#39;October 2020 rainfall anomaly&#39;</span>,</span>
<span id="cb51-3"><a href="plotting.html#cb51-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">discrete_cs =</span> <span class="cn">TRUE</span>, <span class="at">binwidth =</span> <span class="dv">2</span>,</span>
<span id="cb51-4"><a href="plotting.html#cb51-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">low =</span> <span class="st">&#39;red&#39;</span>, <span class="at">mid =</span> <span class="st">&#39;white&#39;</span>, <span class="at">high =</span> <span class="st">&#39;darkgreen&#39;</span>,</span>
<span id="cb51-5"><a href="plotting.html#cb51-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">midpoint =</span> <span class="dv">0</span>,</span>
<span id="cb51-6"><a href="plotting.html#cb51-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">name =</span> <span class="st">&#39;mm/day&#39;</span>)</span></code></pre></div>
<p><img src="02-plotting_files/figure-html/unnamed-chunk-9-1.png" width="480" /></p>
<p>For saving a created plot, we can use any of <code>R</code>s graphical devices, e.g.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="plotting.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pdf</span>(<span class="at">file =</span> <span class="st">&#39;&lt;path to file and filename&gt;.pdf&#39;</span>, <span class="at">width =</span> ...,<span class="at">height =</span> ...)</span>
<span id="cb52-2"><a href="plotting.html#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(pp)</span>
<span id="cb52-3"><a href="plotting.html#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<p>This creates a .pdf file, but you can print .png and some other file formats similarly, see <code>?Devices</code> for an overview.</p>
<p>One final remark: Often you will deal with data tables that contain spatio-temporal data. It is then important to remember subselecting the particular timeslice you want to view, (October 2020 in the examples above). The function <code>ggplot_dt</code> by default tries to select the first timeslice of tempo-spatial data. This is convenient for a quick first look at your data. Here an example:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="plotting.html#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(chirps_monthly) <span class="co"># a data table with multiple months and years and locations, so spatio-temporal data</span></span></code></pre></div>
<pre><code>##          lon   lat      prec month year terc_cat
##      1: 22.0 -12.0 1.9301587    10 1981       -1
##      2: 22.0 -11.5 2.1351602    10 1981       -1
##      3: 22.0 -11.0 2.7692883    10 1981       -1
##      4: 22.0 -10.5 3.9201619    10 1981        0
##      5: 22.0 -10.0 4.8720656    10 1981        1
##     ---                                         
## 418076: 51.5  21.0 0.2404348    12 2020       -1
## 418077: 51.5  21.5 0.2184058    12 2020       -1
## 418078: 51.5  22.0 0.2053623    12 2020       -1
## 418079: 51.5  22.5 0.1615942    12 2020       -1
## 418080: 51.5  23.0 0.1387682    12 2020       -1</code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="plotting.html#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot_dt</span>(chirps_monthly) <span class="co"># generates a plot of the precipitation of October 1981 (first timeslice), for a first quick impression of your data. </span></span></code></pre></div>
<p><img src="02-plotting_files/figure-html/unnamed-chunk-11-1.png" width="480" /></p>
<div id="plotting-values-for-selected-countries" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Plotting values for selected countries</h2>
<p>Above, we have already seen an option how to restrict a plot to a particular country: by manually subsetting the data to a rectangle of longitudes and latitudes containing that specific country. This is of course quite tedious, and to make our lives easier we can use the <code>restrict_to_country</code>-function that takes a data table and a country name, and subsets the data table to only contain gridpoints in the specified country. Currently, the function accepts the following country names: Burundi, Eritrea, Ethiopia, Kenya, Rwanda, Somalia, South Sudan, Sudan, Tanzania, Uganda.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="plotting.html#cb56-1" aria-hidden="true" tabindex="-1"></a>dt_new <span class="ot">=</span> <span class="fu">restrict_to_country</span>(dt[month <span class="sc">==</span> <span class="dv">10</span> <span class="sc">&amp;</span> year <span class="sc">==</span> <span class="dv">2020</span>],<span class="st">&#39;Kenya&#39;</span>)</span>
<span id="cb56-2"><a href="plotting.html#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(dt_new)</span></code></pre></div>
<pre><code>##       lon  lat      prec month year terc_cat     clim        ano
##   1: 34.0 -1.0 4.9593979    10 2020        1 2.964475  1.9949232
##   2: 34.0 -0.5 4.7645891    10 2020        1 3.639693  1.1248956
##   3: 34.0  0.0 4.6154697    10 2020        1 4.284345  0.3311242
##   4: 34.5 -1.0 7.5550100    10 2020        1 4.380272  3.1747380
##   5: 34.5 -0.5 6.4341863    10 2020        1 4.056996  2.3771907
##  ---                                                            
## 187: 41.0 -1.0 0.7533339    10 2020       -1 2.456691 -1.7033568
## 188: 41.0  3.0 1.1354665    10 2020        0 2.135546 -1.0000791
## 189: 41.0  3.5 1.5012010    10 2020        0 2.191273 -0.6900723
## 190: 41.0  4.0 1.8609376    10 2020        0 2.431412 -0.5704748
## 191: 41.5  3.5 1.3543324    10 2020        0 2.447758 -1.0934261</code></pre>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="plotting.html#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot_dt</span>(dt_new, <span class="st">&#39;ano&#39;</span>, </span>
<span id="cb58-2"><a href="plotting.html#cb58-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">mn =</span> <span class="st">&#39;October 2020 rainfall anomaly&#39;</span>,</span>
<span id="cb58-3"><a href="plotting.html#cb58-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">discrete_cs =</span> <span class="cn">TRUE</span>, <span class="at">binwidth =</span> <span class="dv">2</span>,</span>
<span id="cb58-4"><a href="plotting.html#cb58-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">low =</span> <span class="st">&#39;red&#39;</span>, <span class="at">mid =</span> <span class="st">&#39;white&#39;</span>, <span class="at">high =</span> <span class="st">&#39;darkgreen&#39;</span>,</span>
<span id="cb58-5"><a href="plotting.html#cb58-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">midpoint =</span> <span class="dv">0</span>,</span>
<span id="cb58-6"><a href="plotting.html#cb58-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">name =</span> <span class="st">&#39;mm/day&#39;</span>)</span></code></pre></div>
<p><img src="02-plotting_files/figure-html/unnamed-chunk-12-1.png" width="480" /></p>
<p>As we can see, the function restricts the data to all gridcells for which the centerpoint lies within the specified country. This is useful, for example, for calculating mean scores for the specified country. However, it is not optimal for plotting, since all grid cells past the border are censored, even though the original data table contained values there. To this end, the <code>restrict_to_country</code> function has a <code>rectangle</code>-argument that you can set to <code>TRUE</code> for plotting:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="plotting.html#cb59-1" aria-hidden="true" tabindex="-1"></a>dt_new <span class="ot">=</span> <span class="fu">restrict_to_country</span>(dt[month <span class="sc">==</span> <span class="dv">10</span> <span class="sc">&amp;</span> year <span class="sc">==</span> <span class="dv">2020</span>],<span class="st">&#39;Kenya&#39;</span>, <span class="at">rectangle =</span> <span class="cn">TRUE</span>)</span>
<span id="cb59-2"><a href="plotting.html#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot_dt</span>(dt_new, <span class="st">&#39;ano&#39;</span>, </span>
<span id="cb59-3"><a href="plotting.html#cb59-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">mn =</span> <span class="st">&#39;October 2020 rainfall anomaly&#39;</span>,</span>
<span id="cb59-4"><a href="plotting.html#cb59-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">discrete_cs =</span> <span class="cn">TRUE</span>, <span class="at">binwidth =</span> <span class="dv">2</span>,</span>
<span id="cb59-5"><a href="plotting.html#cb59-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">low =</span> <span class="st">&#39;red&#39;</span>, <span class="at">mid =</span> <span class="st">&#39;white&#39;</span>, <span class="at">high =</span> <span class="st">&#39;darkgreen&#39;</span>,</span>
<span id="cb59-6"><a href="plotting.html#cb59-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">midpoint =</span> <span class="dv">0</span>,</span>
<span id="cb59-7"><a href="plotting.html#cb59-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">name =</span> <span class="st">&#39;mm/day&#39;</span>)</span></code></pre></div>
<p><img src="02-plotting_files/figure-html/unnamed-chunk-13-1.png" width="480" /></p>
<p>Instead of a single country name, you can also pass multiple country names in a vector to the function. Moreover, when you use <code>rectangle = TRUE</code>, you can specify a tolerance <code>tol</code> in order to widen the plotting window:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="plotting.html#cb60-1" aria-hidden="true" tabindex="-1"></a>dt_new <span class="ot">=</span> <span class="fu">restrict_to_country</span>(dt[month <span class="sc">==</span> <span class="dv">10</span> <span class="sc">&amp;</span> year <span class="sc">==</span> <span class="dv">2020</span>],</span>
<span id="cb60-2"><a href="plotting.html#cb60-2" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">c</span>(<span class="st">&#39;Kenya&#39;</span>,<span class="st">&#39;Tanzania&#39;</span>),</span>
<span id="cb60-3"><a href="plotting.html#cb60-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">rectangle =</span> <span class="cn">TRUE</span>,<span class="at">tol =</span> <span class="dv">2</span>)</span>
<span id="cb60-4"><a href="plotting.html#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot_dt</span>(dt_new, <span class="st">&#39;ano&#39;</span>, </span>
<span id="cb60-5"><a href="plotting.html#cb60-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">mn =</span> <span class="st">&#39;October 2020 rainfall anomaly&#39;</span>,</span>
<span id="cb60-6"><a href="plotting.html#cb60-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">discrete_cs =</span> <span class="cn">TRUE</span>, <span class="at">binwidth =</span> <span class="dv">2</span>,</span>
<span id="cb60-7"><a href="plotting.html#cb60-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">low =</span> <span class="st">&#39;red&#39;</span>, <span class="at">mid =</span> <span class="st">&#39;white&#39;</span>, <span class="at">high =</span> <span class="st">&#39;darkgreen&#39;</span>,</span>
<span id="cb60-8"><a href="plotting.html#cb60-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">midpoint =</span> <span class="dv">0</span>,</span>
<span id="cb60-9"><a href="plotting.html#cb60-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">name =</span> <span class="st">&#39;mm/day&#39;</span>)</span></code></pre></div>
<p><img src="02-plotting_files/figure-html/unnamed-chunk-14-1.png" width="480" /></p>
<p>The <code>tol = 2</code> argument means that the function will include a buffer zone of 2 degrees lon/lat outside the specified countries (i.e. 4 gridpoints to each side). Note that the buffer to the south of Tanzania is smaller, because the original data table <code>dt</code> does not contain any data further south.</p>
</div>
<div id="customized-plots" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Customized plots</h2>
<p>The function <code>ggplot_dt</code> is, as its name suggests, based on the package <code>ggplot2</code>. This is a widely-used package and there are many books and tutorials available for getting familiar with the syntax, e.g. (this one)[<a href="https://ggplot2-book.org/" class="uri">https://ggplot2-book.org/</a>]. In <code>ggplot2</code>, plots are composed out of multiple layers, allowing for successive adding of layers. This can help us to generate highly customized plots. As an example, let’s revisit the anomaly plot from above and add the location of Nairobi an Addis Abbaba to it:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="plotting.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb61-2"><a href="plotting.html#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="plotting.html#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="co"># get locations as data table:</span></span>
<span id="cb61-4"><a href="plotting.html#cb61-4" aria-hidden="true" tabindex="-1"></a>loc <span class="ot">=</span> <span class="fu">data.table</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">&#39;Addis Abbaba&#39;</span>,<span class="st">&#39;Nairobi&#39;</span>),<span class="at">lon =</span> <span class="fu">c</span>(<span class="fl">38.77</span>,<span class="fl">36.84</span>),<span class="at">lat =</span> <span class="fu">c</span>(<span class="dv">9</span>,<span class="sc">-</span><span class="fl">1.28</span>))</span>
<span id="cb61-5"><a href="plotting.html#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(loc)</span></code></pre></div>
<pre><code>##            name   lon   lat
## 1: Addis Abbaba 38.77  9.00
## 2:      Nairobi 36.84 -1.28</code></pre>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="plotting.html#cb63-1" aria-hidden="true" tabindex="-1"></a>pp <span class="ot">=</span> <span class="fu">ggplot_dt</span>(dt[month <span class="sc">==</span> <span class="dv">10</span> <span class="sc">&amp;</span> year <span class="sc">==</span> <span class="dv">2020</span>], <span class="st">&#39;ano&#39;</span>, </span>
<span id="cb63-2"><a href="plotting.html#cb63-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">mn =</span> <span class="st">&#39;October 2020 rainfall anomaly&#39;</span>,</span>
<span id="cb63-3"><a href="plotting.html#cb63-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">low =</span> <span class="st">&#39;red&#39;</span>, <span class="at">mid =</span> <span class="st">&#39;white&#39;</span>, <span class="at">high =</span> <span class="st">&#39;darkgreen&#39;</span>,</span>
<span id="cb63-4"><a href="plotting.html#cb63-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">midpoint =</span> <span class="dv">0</span>,</span>
<span id="cb63-5"><a href="plotting.html#cb63-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">name =</span> <span class="st">&#39;mm/day&#39;</span>) <span class="sc">+</span> </span>
<span id="cb63-6"><a href="plotting.html#cb63-6" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_point</span>(<span class="at">data =</span> loc,<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> lon,<span class="at">y =</span> lat)) <span class="sc">+</span> </span>
<span id="cb63-7"><a href="plotting.html#cb63-7" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_text</span>(<span class="at">data =</span> loc,<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> lon,<span class="at">y =</span> lat,<span class="at">label =</span> name),<span class="at">vjust =</span> <span class="fl">1.5</span>)</span>
<span id="cb63-8"><a href="plotting.html#cb63-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-9"><a href="plotting.html#cb63-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pp)</span></code></pre></div>
<p><img src="02-plotting_files/figure-html/unnamed-chunk-15-1.png" width="480" /></p>
<p>Here, we added two layers to the original plot, the first one being the <code>geom_point</code>-layer that creates the two points at the locations of the cities, and the second being the <code>geom_text</code>-layer that labels the points by the city names.</p>
<p>A frequently required operation is the changing of the font sizes of title and labels. The easiest way to do this is the command</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="plotting.html#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">16</span>)) <span class="co"># defaults to 12</span></span>
<span id="cb64-2"><a href="plotting.html#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pp)</span></code></pre></div>
<p><img src="02-plotting_files/figure-html/unnamed-chunk-16-1.png" width="576" /></p>
<p>We can also use ggplots adding-layer-syntax to overwrite existing layers, for example if we want a fully customized colorscale:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="plotting.html#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis) <span class="co"># the viridis package contains some nice color scales</span></span>
<span id="cb65-2"><a href="plotting.html#cb65-2" aria-hidden="true" tabindex="-1"></a>pp_new <span class="ot">=</span> pp <span class="sc">+</span> <span class="fu">scale_fill_viridis</span>(<span class="at">name =</span> <span class="st">&#39;my_color_scale&#39;</span>,</span>
<span id="cb65-3"><a href="plotting.html#cb65-3" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="dv">5</span>,<span class="at">by =</span> <span class="dv">2</span>),</span>
<span id="cb65-4"><a href="plotting.html#cb65-4" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">guide =</span> <span class="fu">guide_colorbar</span>(<span class="at">title =</span> <span class="st">&#39;my personal color scale&#39;</span>,</span>
<span id="cb65-5"><a href="plotting.html#cb65-5" aria-hidden="true" tabindex="-1"></a>                                                        <span class="at">title.position =</span> <span class="st">&#39;top&#39;</span>,</span>
<span id="cb65-6"><a href="plotting.html#cb65-6" aria-hidden="true" tabindex="-1"></a>                                                        <span class="at">barwidth =</span> <span class="dv">20</span>,</span>
<span id="cb65-7"><a href="plotting.html#cb65-7" aria-hidden="true" tabindex="-1"></a>                                                        <span class="at">direction =</span> <span class="st">&#39;horizontal&#39;</span>)) <span class="sc">+</span></span>
<span id="cb65-8"><a href="plotting.html#cb65-8" aria-hidden="true" tabindex="-1"></a>              <span class="fu">xlab</span>(<span class="st">&#39;lon&#39;</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&#39;lat&#39;</span>) <span class="sc">+</span>   <span class="co"># label axis</span></span>
<span id="cb65-9"><a href="plotting.html#cb65-9" aria-hidden="true" tabindex="-1"></a>              <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&#39;salmon&#39;</span>), <span class="co"># change background color (used for missing values) to something whackey</span></span>
<span id="cb65-10"><a href="plotting.html#cb65-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(), <span class="co"># add ticks...</span></span>
<span id="cb65-11"><a href="plotting.html#cb65-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">axis.text =</span> <span class="fu">element_text</span>(),  <span class="co"># ... and labels for the axis, i.e. some lons and lats.</span></span>
<span id="cb65-12"><a href="plotting.html#cb65-12" aria-hidden="true" tabindex="-1"></a>                    <span class="at">legend.position =</span> <span class="st">&#39;bottom&#39;</span>) </span>
<span id="cb65-13"><a href="plotting.html#cb65-13" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb65-14"><a href="plotting.html#cb65-14" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pp_new)</span></code></pre></div>
<p><img src="02-plotting_files/figure-html/unnamed-chunk-18-1.png" width="384" /></p>
<p>For comparing multiple plots (potentially all of them with the same legend), the function <code>ggpubr::ggarrange</code> is useful:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="plotting.html#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb66-2"><a href="plotting.html#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="co"># compare 2019 October anomaly to 2020 anomaly:</span></span>
<span id="cb66-3"><a href="plotting.html#cb66-3" aria-hidden="true" tabindex="-1"></a>rr <span class="ot">=</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="dv">5</span>) <span class="co"># force color scale to be identical for the plots</span></span>
<span id="cb66-4"><a href="plotting.html#cb66-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-5"><a href="plotting.html#cb66-5" aria-hidden="true" tabindex="-1"></a>pp1 <span class="ot">=</span> <span class="fu">ggplot_dt</span>(dt[month <span class="sc">==</span> <span class="dv">10</span> <span class="sc">&amp;</span> year <span class="sc">==</span> <span class="dv">2019</span>], <span class="st">&#39;ano&#39;</span>, </span>
<span id="cb66-6"><a href="plotting.html#cb66-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">rr =</span> rr,</span>
<span id="cb66-7"><a href="plotting.html#cb66-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">mn =</span> <span class="st">&#39;October 2019 rainfall anomaly&#39;</span>,</span>
<span id="cb66-8"><a href="plotting.html#cb66-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">low =</span> <span class="st">&#39;red&#39;</span>, <span class="at">mid =</span> <span class="st">&#39;white&#39;</span>, <span class="at">high =</span> <span class="st">&#39;darkgreen&#39;</span>,</span>
<span id="cb66-9"><a href="plotting.html#cb66-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">guide =</span> <span class="fu">guide_colorbar</span>(<span class="at">barwidth =</span> <span class="dv">20</span>,<span class="at">barheight =</span> <span class="dv">1</span>,<span class="at">direction =</span> <span class="st">&#39;horizontal&#39;</span>),</span>
<span id="cb66-10"><a href="plotting.html#cb66-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">midpoint =</span> <span class="dv">0</span>,</span>
<span id="cb66-11"><a href="plotting.html#cb66-11" aria-hidden="true" tabindex="-1"></a>                <span class="at">name =</span> <span class="st">&#39;mm/day&#39;</span>) <span class="sc">+</span> </span>
<span id="cb66-12"><a href="plotting.html#cb66-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> loc,<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> lon,<span class="at">y =</span> lat)) <span class="sc">+</span> </span>
<span id="cb66-13"><a href="plotting.html#cb66-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> loc,<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> lon,<span class="at">y =</span> lat,<span class="at">label =</span> name),<span class="at">vjust =</span> <span class="fl">1.5</span>)</span>
<span id="cb66-14"><a href="plotting.html#cb66-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-15"><a href="plotting.html#cb66-15" aria-hidden="true" tabindex="-1"></a>pp2 <span class="ot">=</span> <span class="fu">ggplot_dt</span>(dt[month <span class="sc">==</span> <span class="dv">10</span> <span class="sc">&amp;</span> year <span class="sc">==</span> <span class="dv">2020</span>], <span class="st">&#39;ano&#39;</span>, </span>
<span id="cb66-16"><a href="plotting.html#cb66-16" aria-hidden="true" tabindex="-1"></a>                <span class="at">rr =</span> rr,</span>
<span id="cb66-17"><a href="plotting.html#cb66-17" aria-hidden="true" tabindex="-1"></a>                <span class="at">mn =</span> <span class="st">&#39;October 2020 rainfall anomaly&#39;</span>,</span>
<span id="cb66-18"><a href="plotting.html#cb66-18" aria-hidden="true" tabindex="-1"></a>                <span class="at">low =</span> <span class="st">&#39;red&#39;</span>, <span class="at">mid =</span> <span class="st">&#39;white&#39;</span>, <span class="at">high =</span> <span class="st">&#39;darkgreen&#39;</span>,</span>
<span id="cb66-19"><a href="plotting.html#cb66-19" aria-hidden="true" tabindex="-1"></a>                <span class="at">midpoint =</span> <span class="dv">0</span>,</span>
<span id="cb66-20"><a href="plotting.html#cb66-20" aria-hidden="true" tabindex="-1"></a>                <span class="at">name =</span> <span class="st">&#39;mm/day&#39;</span>) <span class="sc">+</span> </span>
<span id="cb66-21"><a href="plotting.html#cb66-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> loc,<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> lon,<span class="at">y =</span> lat)) <span class="sc">+</span> </span>
<span id="cb66-22"><a href="plotting.html#cb66-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> loc,<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> lon,<span class="at">y =</span> lat,<span class="at">label =</span> name),<span class="at">vjust =</span> <span class="fl">1.5</span>)</span>
<span id="cb66-23"><a href="plotting.html#cb66-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-24"><a href="plotting.html#cb66-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-25"><a href="plotting.html#cb66-25" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(pp1,pp2,<span class="at">ncol =</span> <span class="dv">2</span>,<span class="at">common.legend =</span> <span class="cn">TRUE</span>,<span class="at">legend =</span> <span class="st">&#39;bottom&#39;</span>)</span></code></pre></div>
<p><img src="02-plotting_files/figure-html/unnamed-chunk-19-1.png" width="960" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="getting-started.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="data-import-and-processing.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
